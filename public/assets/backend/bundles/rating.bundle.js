!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery")):t(jQuery)}(function(y){t.prototype.init=function(t,e){return this.$elem=y(e),this.options=y.extend({},y.fn.barrating.defaults,t),this.options};var a=t;function t(){function r(t,e){null!==e&&"object"==typeof e?p.$elem.data("barrating",e):p.$elem.data("barrating")[t]=e}function e(){var t=(t=p.options.initialRating)?f(t):y("option:selected",p.$elem),e=!(e=p.$elem.find('option[value="'+p.options.emptyValue+'"]')).length&&p.options.allowEmpty?(e=y("<option />",{value:p.options.emptyValue})).prependTo(p.$elem):e,n=t.val(),t=t.data("html")?t.data("html"):t.text(),a=null!==p.options.allowEmpty?p.options.allowEmpty:!!e.length,i=e.length?e.val():null,e=e.length?e.text():null;r(null,{userOptions:p.options,ratingValue:n,ratingText:t,originalRatingValue:n,originalRatingText:t,allowEmpty:a,emptyRatingValue:i,emptyRatingText:e,readOnly:p.options.readonly,ratingMade:!1})}function o(){return h("ratingText")}function l(){return h("ratingValue")}function i(){return h("userOptions").reverse?"nextAll":"prevAll"}function s(t){f(t).prop("selected",!0),p.$elem.change()}function u(t){(t=t||o())==h("emptyRatingText")&&(t=""),p.options.showSelectedRating&&p.$elem.parent().find(".br-current-rating").text(t)}function d(){p.$widget.find("a").removeClass(function(t,e){return(e.match(/(^|\s)br-\S+/g)||[]).join(" ")})}function c(){var t=p.$widget.find('a[data-rating-value="'+l()+'"]'),e=h("userOptions").initialRating,n=y.isNumeric(l())?l():0,a=Math.round(Math.floor(10*e)/10%1*100);d(),t.addClass("br-selected br-current")[i()]().addClass("br-selected"),h("ratingMade")||!y.isNumeric(e)||e<=n||!a||(e=p.$widget.find("a"),(n=t.length?t[h("userOptions").reverse?"prev":"next"]():e[h("userOptions").reverse?"last":"first"]()).addClass("br-fractional"),n.addClass("br-fractional-"+a))}function n(t){t.on("touchstart.barrating",function(t){t.preventDefault(),t.stopPropagation(),y(this).click()})}function a(t){t.off(".barrating")}function g(t){var e=p.$widget.find("a");n(e),t?(a(e),e.on("click.barrating",function(t){t.preventDefault()})):(m(t=e),p.options.hoverState&&(v(t),b(t)))}var p=this,f=function(t){return y.isNumeric(t)&&(t=Math.floor(t)),y('option[value="'+t+'"]',p.$elem)},h=function(t){var e=p.$elem.data("barrating");return void 0!==t?e[t]:e},m=function(t){t.on("click.barrating",function(t){var e,n,a=y(this),i=h("userOptions");return t.preventDefault(),e=a.attr("data-rating-value"),n=a.attr("data-rating-text"),a=a,!h("allowEmpty")||!h("userOptions").deselectable||l()!=a.attr("data-rating-value")||(e=h("emptyRatingValue"),n=h("emptyRatingText")),r("ratingValue",e),r("ratingText",n),r("ratingMade",!0),s(e),u(n),c(),i.onSelect.call(p,l(),o(),t),!1})},v=function(t){t.on("mouseenter.barrating",function(){var t=y(this);d(),t.addClass("br-active")[i()]().addClass("br-active"),u(t.attr("data-rating-text"))})},b=function(t){p.$widget.on("mouseleave.barrating blur.barrating",function(){u(),c()})};this.show=function(){var a,t;h()||(t=["br-wrapper"],""!==p.options.theme&&t.push("br-theme-"+p.options.theme),p.$elem.wrap(y("<div />",{class:t.join(" ")})),e(),p.$widget=(a=y("<div />",{class:"br-widget"}),p.$elem.find("option").each(function(){var t,e,n=y(this).val();n!==h("emptyRatingValue")&&(t=y(this).text(),e=y(this).data("html"),n=y("<a />",{href:"#","data-rating-value":n,"data-rating-text":t=e?e:t,html:p.options.showValues?t:""}),a.append(n))}),p.options.showSelectedRating&&a.append(y("<div />",{text:"",class:"br-current-rating"})),p.options.reverse&&a.addClass("br-reverse"),p.options.readonly&&a.addClass("br-readonly"),a),p.$widget.insertAfter(p.$elem),c(),u(),g(p.options.readonly),p.$elem.hide())},this.readonly=function(t){"boolean"==typeof t&&h("readOnly")!=t&&(g(t),r("readOnly",t),p.$widget.toggleClass("br-readonly"))},this.set=function(t){var e=h("userOptions");0!==p.$elem.find('option[value="'+t+'"]').length&&(r("ratingValue",t),r("ratingText",p.$elem.find('option[value="'+t+'"]').text()),r("ratingMade",!0),s(l()),u(o()),c(),e.silent||e.onSelect.call(this,l(),o()))},this.clear=function(){var t=h("userOptions");r("ratingValue",h("originalRatingValue")),r("ratingText",h("originalRatingText")),r("ratingMade",!1),y("option",p.$elem).prop("selected",function(){return this.defaultSelected}),p.$elem.change(),u(o()),c(),t.onClear.call(this,l(),o())},this.destroy=function(){var t=l(),e=o(),n=h("userOptions");a(p.$widget.find("a")),p.$widget.remove(),p.$elem.removeData("barrating"),p.$elem.unwrap(),p.$elem.show(),n.onDestroy.call(this,t,e)}}y.fn.barrating=function(e,n){return this.each(function(){var t=new a;return y(this).is("select")||y.error("Sorry, this plugin only works with select fields."),t.hasOwnProperty(e)?(t.init(n,this),"show"===e?t.show(n):t.$elem.data("barrating")?(t.$widget=y(this).next(".br-widget"),t[e](n)):void 0):"object"!=typeof e&&e?void y.error("Method "+e+" does not exist on jQuery.barrating"):(n=e,t.init(n,this),t.show())})},y.fn.barrating.defaults={theme:"",initialRating:null,allowEmpty:null,emptyValue:"",showValues:!1,showSelectedRating:!0,deselectable:!0,reverse:!1,readonly:!1,fastClicks:!0,hoverState:!0,silent:!1,onSelect:function(t,e,n){},onClear:function(t,e){},onDestroy:function(t,e){}},y.fn.barrating.BarRating=a});